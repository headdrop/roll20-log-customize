<html>
  <head>
    <link rel="stylesheet" href="editor.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard-dynamic-subset.css" />
    <style>
    </style>

  </head>
  <body>
    <input id="logdata">
    <div contenteditable id="editable"></div>
    <p class="font">'설정하지 않음'에 체크하면 <b>티스토리에서 설정한 기본 폰트 크기</b>로 출력됩니다.<br>미리보기의 폰트 사이즈는 13px입니다.</p>
    <div class="font"><span>폰트 사이즈</span>설정하지 않음<input type="checkbox" id="font-size-tog" value="unset" checked><input type="number" id="font-size" pattern="\d*" disabled>px</div>
    <p>다음 버튼을 차례대로 누릅니다.
    <br>이 단계에서 브라우저 에러가 발생할 경우, 브라우저의 <b>시크릿 모드</b>로 이 페이지를 이용해보세요</p>
    
    <div class="box">
      <button id="log-paste">1. 티스토리로 복사 준비</button>
      <button id="copy" data-clipboard-target="#logdata">2. HTML 코드 복사하기</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script>
    <script>
      document.getElementById("font-size-tog").addEventListener('change',(tog)=>{
        var tg = tog.target;
        if (tg.checked) {
          tg.nextSibling.setAttribute("disabled",true);
          tg.nextSibling.value="";
        } else {
          tg.nextSibling.removeAttribute("disabled");
        }
      })
      document.querySelector("#log-paste").addEventListener('click',()=>{
        var htmlContent = document.getElementById("editable").innerHTML;
        var fontTog = document.getElementById("font-size-tog").checked;
        var fontSize;
        htmlContent = htmlContent.replace(/( id=".+?")|( class="(?!sheet-rolltemplate).+?")|(box-sizing: border-box; )|(data-.+?(" ))/gi|/(font-size: 13px;)/gi,''); // 제거
        htmlContent = htmlContent.replace(/<a style/gi,'<span style').replace(/<\/a>/gi,'</span>');
        if (fontTog) { // font size 사용하지않음 체크
          htmlContent = htmlContent.replace(/font-size: 13px;/gi,'');
        } else { 
          fontSize = document.getElementById('font-size').value;
          htmlContent = htmlContent.replace(/font-size: 13px;/gi,"font-size: "+fontSize+"px;");
        }
        document.getElementById("logdata").value=htmlContent;
      });
      
      //복사
      var clipboard = new ClipboardJS('#copy');
      clipboard.on('success', function(e) {
        alert("로그를 복사했습니다. 티스토리 HTML 모드에서 붙여넣습니다.");
      });

    </script>
  </body>
</html>